!function(e){function t(t){for(var r,a,s=t[0],c=t[1],u=t[2],d=0,f=[];d<s.length;d++)a=s[d],Object.prototype.hasOwnProperty.call(i,a)&&i[a]&&f.push(i[a][0]),i[a]=0;for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(e[r]=c[r]);for(l&&l(t);f.length;)f.shift()();return o.push.apply(o,u||[]),n()}function n(){for(var e,t=0;t<o.length;t++){for(var n=o[t],r=!0,s=1;s<n.length;s++){var c=n[s];0!==i[c]&&(r=!1)}r&&(o.splice(t--,1),e=a(a.s=n[0]))}return e}var r={},i={1:0},o=[];function a(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=e,a.c=r,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)a.d(n,r,function(t){return e[t]}.bind(null,r));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="";var s=window.webpackJsonp=window.webpackJsonp||[],c=s.push.bind(s);s.push=t,s=s.slice();for(var u=0;u<s.length;u++)t(s[u]);var l=c;o.push([37,0]),n()}({0:function(e,t,n){"use strict";var r=n(5);t.a={IDTYPE:{MSACID:"MSACID",ORGIDPUID:"OrgIdPUID"},ACTIVITY:{AUTHENTICATION:{NAME:"authentication"},AUTHORIZATION:{NAME:"authorization"},NOTIFICATION:{NAME:"notification"},TELEMETRY:{NAME:"telemetry"},USERINFO_AVAILABLE:{NAME:"userInfoAvailable"},SSO:{NAME:"sso"},LOGOUT:{NAME:"logout"},REQUEST_TOKEN:{NAME:"requestToken"},LOG:{NAME:"log"}},APPINFO_NAME:"OfficeOnlineExtension",FILE:{APPLICATION_IMAGE_PATH:{excel:"assets/excel_doc.png",onenote:"assets/onenote_doc.png",powerpoint:"assets/powerpoint_doc.png",unknown:"assets/generic_doc.png",word:"assets/word_doc.png"},APPLICATION_LABEL:{excel:"ExcelOnlineAppName",onenote:"OneNoteOnlineAppName",powerpoint:"PowerPointOnlineAppName",unknown:"OfficeOnlineAppName",word:"WordOnlineAppName"},ERROR:{FILE_SIZE_MAX_EXCEEDED:"fileSizeMaxExceeded",LOAD_FROM_PATH:"loadFromPath",UNSUPPORTED_FILE_TYPE:"unsupportedFileType"},MAX_SIZE_BYTE_LIMIT:4194304,OFFICE_APP_FILE_ASSOCIATIONS:{EXCEL:"excel",ONENOTE:"onenote",POWERPOINT:"powerpoint",WORD:"word"},OFFICE_MIME_TYPES:{"application/msword":"word","application/vnd.openxmlformats-officedocument.wordprocessingml.document":"word","application/vnd.openxmlformats-officedocument.wordprocessingml.template":"word","application/vnd.oasis.opendocument.text":"word","application/vnd.ms-powerpoint":"powerpoint","application/vnd.openxmlformats-officedocument.presentationml.presentation":"powerpoint","application/vnd.openxmlformats-officedocument.presentationml.slideshow":"powerpoint","application/vnd.oasis.opendocument.presentation":"powerpoint","application/vnd.ms-excel":"excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":"excel","application/vnd.ms-excel.sheet.binary.macroEnabled.12":"excel","application/vnd.ms-excel.sheet.macroEnabled.12":"excel","application/vnd.oasis.opendocument.spreadsheet":"excel"},ORIGIN:{HTML5:"html5",LOCAL_PATH:"local_path"},SUPPORTED_APPLICATIONS:["Word","Excel","PowerPoint","OneNote"],SUPPORTED_FILE_TYPES:{doc:"word",dot:"word",docx:"word",dotx:"word",odt:"word",ppt:"powerpoint",pot:"powerpoint",pps:"powerpoint",pptx:"powerpoint",ppsx:"powerpoint",odp:"powerpoint",xlsx:"excel",xlsm:"excel",xlsb:"excel",ods:"excel",notebook:"onenote"}},JQUERY:{EVENT_ID:{KEYPRESS:{ENTER:13,ARROWLEFT:37,ARROWUP:38,ARROWRIGHT:39,ARROWDOWN:40},MOUSEDOWN:{LEFT_BUTTON_CLICK:1}}},LINKS:{OFFICE_URL:"https://portal.office.com/home",PROGRESSPAGE_URL:"https://onedrive.live.com",SETTINGS_URL:"chrome://extensions",SIGNUP:"https://onedrive.live.com/about",UNINSTALL:"https://contentstorage.osi.office.net/officeonlineextensionuninstall/uninstall.html",OFFICE_HOME_URL:"https://go.microsoft.com/fwlink/?linkid=859986",OFFICE_HOME_DEV_URL:"https://go.microsoft.com/fwlink/?linkid=860665",SUPPORT_URL:"https://aka.ms/officeextsignin",SUPPORT_URL_EDITOR:"https://aka.ms/OfficeEditorExtension",MYACCOUNT_MSA_URL:"https://go.microsoft.com/fwlink/?LinkId=823747",MYACCOUNT_O365_URL:"https://go.microsoft.com/fwlink/?LinkId=824642",APP:{WORD:function(){return`https://office.live.com/start/word.aspx?auth=${arguments[0]}&WT.mc_id=Chrome_OfficeApp`},EXCEL:function(){return`https://office.live.com/start/excel.aspx?auth=${arguments[0]}&WT.mc_id=Chrome_OfficeApp`},POWERPOINT:function(){return`https://office.live.com/start/powerpoint.aspx?auth=${arguments[0]}&WT.mc_id=Chrome_OfficeApp`},ONENOTE:function(){return`https://www.onenote.com/notebooks?auth=${arguments[0]}&WT.mc_id=Chrome_OfficeApp`},SWAY:function(){return`https://www.sway.com/?auth_pvr=${arguments[0]}&auth_upn=${arguments[1]}&WT.mc_id=Chrome_OfficeApp`},SWAY_DEFAULT:"https://www.sway.com/?WT.mc_id=Chrome_OfficeApp",ONEDRIVE:"https://onedrive.live.com",TEAMS:"https://teams.microsoft.com",SHAREPOINT_DEFAULT:"https://products.office.com/sharepoint",OUTLOOK_DEFAULT:"https://outlook.com",OUTLOOK_O365:"https://outlook.office365.com"}},MENU_VIEWMODE:{NONE:0,NEW:1,OPEN:2,ACCOUNT:3,SETTINGS:4},OAUTH:{ACCESS_TOKEN:"access_token",AUTH_CODE:"authorization_code",CODE:"code",EXPIRES_ON:"expires_on",REFRESH_TOKEN:"refresh_token",SERVICE_ENDPOINT:"service_endpoint",SERVICE_ID:"service_id"},O365CONFIG:{CLIENT_ID:"d08f258a-c5dd-4a8f-8afc-9321d67c767a",CLIENT_SECRET:"4C3JSV:94f_WBYDF+RkH@TX9QhIrzijR",GRAPH_RESOURCE:"https://graph.microsoft.com",ENDPOINTS:{"officeapps.live.com":"https://officeapps.live.com","graph.microsoft.com":"https://graph.microsoft.com"},INSTANCE:"https://login.windows.net/common/oauth2/",LOGOUT_URI:"https://login.microsoftonline.com/logout.srf",MRU_URL:"https://ocws.officeapps.live.com/ocs/docs/recent/",PHOTO_URL:"https://graph.microsoft.com/v1.0/me/photo/$value",ONEDRIVE_URL:"https://graph.microsoft.com/v1.0/me/drive/root",SHAREPOINT_URL:"https://graph.microsoft.com/v1.0/sites/root",REDIRECT_URI:"https://login.microsoftonline.com/login.srf",UPLOAD_URL:"https://graph.microsoft.com/v1.0/me/drive/root:/",FEDERATED_URL:"https://login.microsoftonline.com/getuserrealm.srf"},MSACONFIG:{CLIENT_ID:"000000004016DA34",CLIENT_SECRET:"qXom9iuDN8qMUKe5oU6DHrRxS8bikLrI",INSTANCE:"https://login.live.com/oauth20_authorize.srf",LOGOUT_URI:"https://login.live.com/oauth20_logout.srf",ONEDRIVE_ITEMS_URL:"https://api.onedrive.com/v1.0/drive/items/",PHOTO_URL:"https://apis.live.net/v5.0/me/picture",REDIRECT_URI:"https://login.live.com/oauth20_desktop.srf",SCOPE:"wl.basic+wl.emails+wl.signin+wl.offline_access+onedrive.readwrite+wl.skydrive",URL:"https://login.live.com/oauth20_token.srf",USERINFO_URL:"https://apis.live.net/v5.0/me"},NOTIFICATION:{FILEACCESS:{id:"fileAccess",priority:0,type:"basic",message:"NotificationFileAccess"},FILE_MAX_SIZE_BYTE_LIMIT_REACHED:{id:"fileMaxSizeByteLimitReached",priority:2,type:"basic",message:"NotificationFileMaxSizeByteLimitReached"},FILE_UPLOAD_FAILURE_GENERIC:{id:"fileUploadFailureGeneric",priority:2,type:"basic",message:"NotificationFileUploadFailureGeneric"},FILE_UPLOAD_FAILURE_SERVER:{id:"fileUploadFailureServer",priority:2,type:"basic",message:"NotificationFileUploadFailureServer"},FILE_UPLOAD_FAILURE_UNSUPPORTED_MEDIA:{id:"fileUploadFailureUnsupportedMedia",priority:2,type:"basic",message:"NotificationFileUploadFailureUnsupportedMedia"},FILE_UPLOAD_IN_PROGRESS:{id:"fileUploadInProgress",priority:0,type:"basic",message:"NotificationFileUploadInProgress"},SETDEFAULT:{id:"setDefault",priority:0,type:"basic",message:"NotificationSetDefault"},AUTOSAVE:{id:"autoSave",priority:0,type:"basic",buttons:[{title:"NotificationAutoSaveButton"}]},AUTOSAVETOONEDRIVE:"NotificationAutoSaveToOneDrive",AUTOSAVETOSHAREPOINT:"NotificationAutoSaveToSharePoint",NOTSIGNEDIN:{id:"notSignedIn",priority:2,type:"basic",message:"NotificationNotSignedIn"},UNSUPPORTEDFILETYPE:{id:"unsupportedFileType",priority:2,type:"basic",message:"NotificationUnsupportedFileType"},INVALIDSUBSCRIPTION:{id:"invalidSubscription",priority:2,type:"basic",message:"NotificationInvalidSubscription"},WEBDOCREDIRECT:{id:"webDocRedirect",priority:0,type:"basic",message:"NotificationWebDocRedirect",buttons:[{title:"NotificationWebDocRedirectButton"}]}},ONEDRIVE:{DISPLAY_URL:"https://onedrive.live.com/view.aspx?cid=",INSTANCE:"https://api.onedrive.com/v1.0",QUERY_OPTION:"?@name.conflictBehavior=rename"},RECENTS:{LIST_LENGTH_MSA:3,LIST_LENGTH_O365:3,FILTER:"?apps=powerpoint,word,excel,onenote&sort=date",ONEDRIVE_ENDPOINT:"https://api.onedrive.com/v2.1/drive/recent",DISPLAY_PANEL:{ERROR:0,LIST:1,LOADING:2,NO_DOCS:3,NONE:4},ERROR:{CANCELLED:0,GENERIC:1,NO_DOCS_FOUND:2,UNSUPPORTED_USER_TYPE:3}},SIGNINSTATUS:{UNKNOWN:-1,NONE:0,HASREFRESHTOKEN:1,SIGNEDIN:2},TELEMETRY:{COMMAND:{SET_DISABLED:"setDisabledTelemetry",TRACK_TRACE:"trackTrace",TRACK_EVENT:"trackEvent"},ENABLED_SETTING_STORAGE_KEY:"telemetry_enabled",EVENT_PREFIX:"OO_CHROME_",PII_TYPE:{IDENTITY:10}},USER_TYPE:{MSA:"msa",O365:"aad",NONE:"none"},USER_SERVICE_TYPE:{MSA:"msaUserService",O365:"o365UserService",MSID:"msidUserService",NONE:"noneUserService"},TIMEOUT:{DEFAULT_REQUEST:1e4,USER_INFO_LOOKUP:5e3,USER_INFO_LOOKUP_TEST:50},COPY_PASTE:{TEST:r.a.testCommand,PASTE:r.a.pasteCommand,GET_CLIPBOARD_DATA:r.a.getClipboardDataCommand,GET_AVAILABLE_COMMANDS:r.a.getAvailableCommandsCommand},ERROR_RETRIES:{HTTP_REQUEST:3},BROWSER_ICON:{DEFAULT:"../assets/icon_20.png",INACTIVE:"../assets/icon_inactive_20.png"},SSO:{MESSAGE_CHANNEL:"com.microsoft.browsercore",RESPONSE_STATUS_SUCCESS:"Success",RESPONSE_STATUS_FAIL:"Fail",RESPONSE_CODE_NO_SUPPORT:"NoSupport",RESPONSE_CODE_INVALID:-2147186943}}},1:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(2);window.Utilities||(window.Utilities={deserializeQuery:function(e){var t,n=/\+/g,r=/([^&=]+)=?([^&]*)/g,i=function(e){return decodeURIComponent(e.replace(n," "))},o={};for(t=r.exec(e);t;)o[i(t[1])]=i(t[2]),t=r.exec(e);return o},getFileExtension:function(e){var t="";if(e){var n=e.match(/(?:\.)(\w+)$/);n&&n.length>1&&(t=n[n.length-1].toLowerCase())}return t},navigateToUrlWithNewTab:function(e,t){r.default.tabs.create({url:e,active:!!this.isUndefinedOrNull(t)||t})},isNotUndefinedOrNull:function(e){return!this.isUndefinedOrNull(e)},isUndefinedOrNull:function(e){return null==e},isExtensionInTestingMode:function(){return this.isNotUndefinedOrNull(window.jasmine)},isExtensionInDevelopmentMode:function(){if(this.isExtensionInTestingMode())return!1;if(window.browser&&window.browser.extension){var e=r.default.runtime.getURL("");if(null!=e&&/_microsoftofficeonline_/i.test(e))return!1}if(window.chrome&&window.chrome.extension){var t=this.getManifest();if(null==t)return!1;if(void 0!==t.key||void 0!==t.update_url)return!1}return!0},isEditorEnabled:function(){if(!window.chrome||!window.chrome.extension)return!1;var e=this.getManifest();return e&&e.background&&e.background.scripts&&e.background.scripts.includes("editor/background.js")},shouldShowEditorMaterial:function(){if(!window.chrome||!window.chrome.extension)return!1;var e=this.getManifest();return e&&e.version_name&&-1!=e.version_name.indexOf("[ed]")},getAppDescription:function(){if(window.chrome&&window.chrome.extension)return this.getManifest().description},getManifest:function(){if("object"!=typeof r.default.runtime||"function"!=typeof r.default.runtime.getManifest)return null;var e=r.default.runtime.getManifest();return null==e?null:e},isBackgroundContext:function(){var e=window.location.href;return!!(window.browser&&window.browser.extension&&/^ms-browser-extension/.test(e)&&window===r.default.extension.getBackgroundPage())||!!(window.chrome&&window.chrome.extension&&/^chrome/.test(e)&&window===r.default.extension.getBackgroundPage())},getCurrentTime:function(){return Math.round((new Date).getTime()/1e3)},isChrome:function(){var e=window.navigator,t=e.userAgent.indexOf("OPR")>-1,n=e.userAgent.indexOf("Edg")>-1;return this.isNotUndefinedOrNull(window.chrome)&&e.vendor.indexOf("Google")>-1&&!1===t&&!1===n},getBrowserName:function(){return this.isChrome()?"Chrome":"Edge"},isRTL:function(){var e=r.default.i18n.getUILanguage();return!!(/^ar/i.test(e)||/^fa/i.test(e)||/^he/i.test(e))},setIcon:function(e){r.default.browserAction.setIcon({path:e})}}),t.default=window.Utilities},14:function(e,t,n){"use strict";var r=n(3),i=n.n(r),o=n(1),a=n.n(o),s=n(2),c=n.n(s),u=n(0),l=n(4);i.a.module("app.diagnostics",[]).service("telemetry",["$injector","ariaTelemetry",function(e,t){var n=[t],r=async function(t){var n=e.get("userService");a.a.isUndefinedOrNull(t)&&(t={}),t.pii=[];var r=a.a.getManifest();r&&(t.appVersion=r.version);var i=c.a.i18n.getUILanguage();a.a.isNotUndefinedOrNull(i)&&(t.language=i),t["AppInfo.Name"]=u.a.APPINFO_NAME;var o=await n.getUserType(),s=l.AWTLogManager.getSemanticContext();if(o===u.a.USER_TYPE.NONE)return s.setUserId("","",""),t;var d=await n.getUserInfo(o);return a.a.isUndefinedOrNull(d)?(s.setUserId("","",""),t):(a.a.isNotUndefinedOrNull(d.cid)&&(t.cid=d.cid,s.setUserId(d.cid),t["UserInfo.IdType"]=u.a.IDTYPE.MSACID),a.a.isNotUndefinedOrNull(d.features)&&(t.experimentFeatures=d.features),a.a.isNotUndefinedOrNull(d.puid)&&(t.pii.push({type:u.a.TELEMETRY.PII_TYPE.IDENTITY,name:"puid",value:d.puid}),s.setUserId(d.puid),t["UserInfo.IdType"]=u.a.IDTYPE.ORGIDPUID),a.a.isNotUndefinedOrNull(d.tid)&&(t["UserInfo.OMSTenantId"]=d.tid),t)},o=function(){var t=e.get("$q"),n=e.get("storage"),r=t.defer();return n.get(["telemetry_enabled","enableTelemetry"]).then((function(e){r.resolve(!(!a.a.isUndefinedOrNull(e)&&!0!==function(e,t){if(e[t]){var n=JSON.parse(e[t]);if(void 0!==n.value)return JSON.parse(n.value)}}(e,"enableTelemetry")&&!a.a.isUndefinedOrNull(e.telemetry_enabled)&&!0!==e.telemetry_enabled))})),r.promise};return{getEnabledSetting:function(){return o()},setEnabledSetting:function(t){if(a.a.isBackgroundContext()){!function(t){e.get("storage").set({telemetry_enabled:t,enableTelemetry:JSON.stringify({value:JSON.stringify(t),lastUpdate:Date.now(),manualOverride:!1})})}(t);for(var r=0;r<n.length;++r)n[r].setEnabledSetting(t)}else c.a.runtime.sendMessage({activity:u.a.ACTIVITY.TELEMETRY.NAME,command:u.a.TELEMETRY.COMMAND.SET_DISABLED,enabled:t})},trackEvent:async function(e,t,o){if(!i.a.isUndefined(e)&&i.a.isString(e))if(a.a.isBackgroundContext()){t=await r(t);for(var s=0;s<n.length;++s){var l=i.a.extend({},t);n[s].trackEvent(e,l,o)}}else c.a.runtime.sendMessage({activity:u.a.ACTIVITY.TELEMETRY.NAME,command:u.a.TELEMETRY.COMMAND.TRACK_EVENT,eventName:e,properties:t,measurements:o})},trackTrace:async function(e,t){if(!i.a.isUndefined(e)&&i.a.isString(e))if(a.a.isBackgroundContext()){t=await r(t);for(var o=0;o<n.length;++o){var s=i.a.extend({},t);n[o].trackTrace(e,s)}}else c.a.runtime.sendMessage({activity:u.a.ACTIVITY.TELEMETRY.NAME,command:u.a.TELEMETRY.COMMAND.TRACK_TRACE,message:e,properties:t})}}}]).service("ariaTelemetry",["$window",function(e){var t=function(e,t){if(!a.a.isUndefinedOrNull(e)&&!a.a.isUndefinedOrNull(t)){if(!a.a.isUndefinedOrNull(t.pii)){for(var n=0;n<=t.pii.length-1;++n)e.setProperty(t.pii[n].name,t.pii[n].value,t.pii[n].type);delete t.pii}for(var r in t)t.hasOwnProperty(r)&&e.setProperty(r,t[r])}},n=!0;this.setEnabledSetting=function(e){n=e},this.trackEvent=function(r,i,o){if(n){r=r.replace(/\./g,"_");var a=new l.AWTEventProperties;a.setName(u.a.TELEMETRY.EVENT_PREFIX+r),t(a,i),t(a,o),e.ariaLogger.logEvent(a)}},this.trackTrace=function(r,i){if(n){var o=new l.AWTEventProperties;o.setName(u.a.TELEMETRY.EVENT_PREFIX+r),o.setProperty("severity",r),t(o,i),e.ariaLogger.logEvent(o)}}}]).name},2:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=[],i={};t.default=function(){var e=(()=>{if("object"==typeof browser){var e=Object.create(browser);e.notifications={clear:function(e,t){t(!1)},create:function(e,t,n){null!=t&&void 0!==t.priority&&null!==t.priority&&t.priority>0&&window.alert(t.message),n(e)},onButtonClicked:{addListener:function(e){}},onClicked:{addListener:function(e){}}},e.runtime={getPlatformInfo:function(e){}}}else if("object"==typeof chrome)return Object.create(chrome)})();if(window.jasmine){e=function e(t,n){for(const[r,i]of Object.entries(n))t[r]?typeof i==typeof t[r]?Array.isArray(i)?t[r]=t[r].concat(i):t[r]="object"!=typeof i?i:e(t[r],i):console.log(`skipping ${r} due to conflicting types`):t[r]=i;return t}(e||{},{mock:!0,browserAction:{setIcon:function(e){}},extension:{getURL:function(e){return""}},i18n:{getUILanguage:function(e,t){return""},getMessage:function(){return""}},runtime:{onMessage:{addListener:function(e){r.push(e)},removeListener:function(e){r.splice(r.indexOf(e),1)}},sendMessage:function(e){for(let t=0;t<r.length;++t)r[t](e)},id:"ndjpnladcallmjemlbaebfadecfhkepb"},storage:{local:{get:function(e,t){t({[e]:i[e]})},set:function(e){for(const t in e)e.hasOwnProperty(t)&&(i[t]=e[t])},remove:function(e,t){delete i[e],t(i)},clear:function(e,t){i={}}}},tabs:{create:function(e,t){t&&t({})}}}),window.chrome||(window.chrome=e)}return window.BrowserHandler||(window.BrowserHandler=e),e}()},23:function(e,t,n){},24:function(e,t,n){"use strict";var r=n(3),i=n.n(r),o=n(1),a=n.n(o),s=n(2),c=n.n(s),u=n(0);n(7),i.a.module("app.user",[]).config(["$httpProvider","$provide",function(e,t){e.interceptors.push("protectedResourceInterceptor")}]).factory("protectedResourceInterceptor",["$q","$log","$injector",function(e,t,n){var r=n.get("userService");return{request:function(n){var i=e.defer();if(a.a.isUndefinedOrNull(n)||a.a.isUndefinedOrNull(n.headers))return t.error("protectedResourceInterceptor.request: http request config is null or undefined"),i.resolve(n),i.promise;var o=n.headers["X-UserType"];if(a.a.isUndefinedOrNull(o))return i.resolve(n),i.promise;var s=n.headers["X-Resource"];return delete n.headers["X-Resource"],delete n.headers["X-UserType"],r.acquireToken(o,n.url,s).then(e=>{a.a.isUndefinedOrNull(e)?t.warn(`failed to get auth token for type:${o} url: ${n.url}, resource ${s}`):n.headers.Authorization="Bearer "+e,i.resolve(n)}),i.promise},responseError:function(t){if(t&&401===t.status){if(a.a.isNotUndefinedOrNull(t.config)&&(t.config.url===u.a.O365CONFIG.SHAREPOINT_URL||t.config.url===u.a.O365CONFIG.PHOTO_URL))return e.reject(t);r.clearToken()}return e.reject(t)}}}]).service("msaUserService",["$log","$injector",function(e,t){this.type=u.a.USER_TYPE.MSA,this.type=u.a.USER_SERVICE_TYPE.MSA,this.userType=u.a.USER_TYPE.MSA,this.getConfig=function(){return{tokenUrl:u.a.MSACONFIG.URL,params:{client_id:u.a.MSACONFIG.CLIENT_ID,client_secret:u.a.MSACONFIG.CLIENT_SECRET,redirect_uri:u.a.MSACONFIG.REDIRECT_URI},resource:u.a.ONEDRIVE.INSTANCE,loginUrl:u.a.MSACONFIG.INSTANCE+"?response_type=code&client_id="+u.a.MSACONFIG.CLIENT_ID+"&redirect_uri="+u.a.MSACONFIG.REDIRECT_URI+"&scope="+u.a.MSACONFIG.SCOPE,logoutUrl:u.a.MSACONFIG.LOGOUT_URI,photoUrl:u.a.MSACONFIG.PHOTO_URL,documentsUrl:u.a.RECENTS.ONEDRIVE_ENDPOINT}},this.lookupUserInfo=async function(e){return new Promise((e,n)=>{var r={oneDriveUrl:u.a.LINKS.APP.ONEDRIVE};t.get("$http")({method:"GET",url:u.a.MSACONFIG.USERINFO_URL,headers:{"X-UserType":u.a.USER_SERVICE_TYPE.MSA}}).then((function(t){var n=t.data;r.email=n.emails.account,r.cid=n.id,e(r)}),(function(){n("msaUser.Service.lookupUserInfo http request failed")}))})},this.getResourceForEndpoint=function(e){return u.a.MSACONFIG.SCOPE}}]).service("o365UserService",["$log","$injector","notification",function(e,t,n){this.type=u.a.USER_SERVICE_TYPE.O365,this.userType=u.a.USER_TYPE.O365,this.getConfig=function(){return{tokenUrl:u.a.O365CONFIG.INSTANCE+"token",params:{client_id:u.a.O365CONFIG.CLIENT_ID,client_secret:u.a.O365CONFIG.CLIENT_SECRET,redirect_uri:u.a.O365CONFIG.REDIRECT_URI,resource:u.a.O365CONFIG.GRAPH_RESOURCE},resource:u.a.O365CONFIG.GRAPH_RESOURCE,loginUrl:u.a.O365CONFIG.INSTANCE+"authorize?response_type=code&client_id="+u.a.O365CONFIG.CLIENT_ID+"&redirect_uri="+u.a.O365CONFIG.REDIRECT_URI+"&response_mode=query",logoutUrl:u.a.O365CONFIG.LOGOUT_URI,photoUrl:u.a.O365CONFIG.PHOTO_URL,documentsUrl:u.a.O365CONFIG.MRU_URL+u.a.RECENTS.FILTER}},this.getResourceForEndpoint=function(e){var t=this.getConfig().resource;if(a.a.isUndefinedOrNull(e))return t;for(var n in u.a.O365CONFIG.ENDPOINTS)if(u.a.O365CONFIG.ENDPOINTS.hasOwnProperty(n)&&e.indexOf(n)>-1){t=u.a.O365CONFIG.ENDPOINTS[n];break}return t},this.lookupUserInfo=async function(r){var i=function(t){var n={},r=function(t){var n=function(t){var n=/^([^.\s]*)\.([^.\s]+)\.([^.\s]*)$/.exec(t);if(!n||n.length<4)return e.error("The returned id_token is not parseable."),null;return{header:n[1],JWSPayload:n[2],JWSSig:n[3]}}(t);if(!n)return null;try{var r=function(e){if(e=e.replace(/-/g,"+").replace(/_/g,"/"),window.atob)return decodeURIComponent(escape(window.atob(e)));return null}(n.JWSPayload);return r?JSON.parse(r):(this._logstatus("The returned id_token could not be base64 url safe decoded."),null)}catch(t){e.error("The returned id_token could not be decoded: "+t.stack)}return null}(t);r&&r.hasOwnProperty("aud")&&(r.aud.toLowerCase()===u.a.O365CONFIG.CLIENT_ID.toLowerCase()?(r.hasOwnProperty("upn")?n.email=r.upn:r.hasOwnProperty("email")&&(n.email=r.email),r.hasOwnProperty("puid")&&(n.puid=r.puid),r.hasOwnProperty("tid")&&(n.tid=r.tid)):e.error("IdToken has invalid aud field"));return n}(r.id_token);const o=await async function(){var r={method:"GET",url:u.a.O365CONFIG.ONEDRIVE_URL,headers:{"X-UserType":u.a.USER_TYPE.O365}},i=t.get("userService");try{var o=await i.httpRequest(r);return o.webUrl?o.webUrl:Promise.reject("o365UserService.DiscoverServiceEndpoint - Invalid resource")}catch(r){return t.get("userService").clearToken(),n.show(u.a.NOTIFICATION.INVALIDSUBSCRIPTION),e.error("0365User.getOneDriveUrl failed: %s",r),null}}();i.oneDriveUrl=o;const a=await async function(){var n={method:"GET",url:u.a.O365CONFIG.SHAREPOINT_URL,headers:{"X-UserType":u.a.USER_SERVICE_TYPE.O365}},r=t.get("userService");try{var i=await r.httpRequest(n);return i.webUrl?i.webUrl:Promise.reject("No SharePoint info for user")}catch(t){return e.error("0365User.getSharePointUrl failed: %s",t),null}}();return i.sharePointUrl=a||u.a.LINKS.APP.SHAREPOINT_DEFAULT,i}}]).service("msidUserService",["$log","$injector","notification",function(e,t,n){const r=u.a.USER_SERVICE_TYPE.MSID;var i=void 0;const o="email openid profile user.read",a="https://graph.microsoft.com/v1.0/me/",s=new URL("https://login.microsoftonline.com/common/oauth2/").toString(),c=(new URL("https://login.live.com/oauth20_authorize.srf").toString(),new URL("nativeclient",s).toString()),l=new URL("v2.0/logoutsession",s).toString(),d=new URL("v2.0/authorize",s).toString(),f=(()=>{var e=new URL(d);return e.search=E({prompt:"select_account"}),e.toString()})();function p(){return i||(i=t.get("userService")),i}function E(e){const t={client_id:"e28ff72c-58a5-49ba-8125-42ec264d7cd0",response_type:"id_token token",redirect_uri:c,scope:o,response_mode:"fragment"};return new URLSearchParams(Object.assign({},t,e)).toString()}async function m(){var e={method:"GET",url:a,headers:{"X-UserType":r}},t={};try{t=function(e){for(const t in e)e.hasOwnProperty(t)&&t.match(/^@odata/i)&&delete e[t];return e}(await p().httpRequest(e))}catch(e){return Promise.reject("msidUser.fetchUserInfo failed: "+e)}return t}async function T(){var t={method:"GET",url:u.a.O365CONFIG.ONEDRIVE_URL,headers:{"X-UserType":r}};try{var i=await p().httpRequest(t);return i.webUrl?{oneDriveUrl:i.webUrl}:Promise.reject("o365UserService.DiscoverServiceEndpoint - Invalid resource")}catch(t){return n.show(u.a.NOTIFICATION.INVALIDSUBSCRIPTION),e.error("msidUser.fetchOneDriveUrl failed: "+JSON.stringify(t)),null}}async function S(){var t={method:"GET",url:"https://graph.microsoft.com/v1.0/me/drive",headers:{"X-UserType":r}};try{var n=await p().httpRequest(t),i=parseInt(n.quota.total)/1073741824;return i=Math.round(100*i)/100,e.info(`OneDrive quota: ${JSON.stringify(n.quota,null,"\t")} capacity: ${i}GB`),{driveQuota:n.quota.total,driveQuotaString:i+"GB"}}catch(e){return Promise.reject("msidUser.fetchOneDriveQuota failed: "+e)}}return{type:r,getConfig:function(){return{loginUrl:f,logoutUrl:l,photoUrl:"https://graph.microsoft.com/beta/me/photo/$value",userInfoUrl:a,documentsUrl:"https://graph.microsoft.com/v1.0/me/drive/recent"}},getResourceForEndpoint:function(t){if(!t)return o;const n={"https://graph.microsoft.com":{"/v1.0/me/":o,"/v1.0/me/drive/recent":"Files.ReadWrite.All"},"https://nleditor.osi.office.net":{"/NlEditor/":"https://nleditor.osi.office.net/NlEditor/instrumentation.write"}};try{const e=new URL(t);if(!n.hasOwnProperty(e.origin))return o;const r=n[e.origin],i=e.pathname;return r[Object.keys(r).reduce((e,t)=>i.startsWith(t)&&t.length>e.length?t:e)]}catch(t){return e.warning("msidUser.Service threw an exception: "+t),o}},lookupUserInfo:async function(e){const t=[m(),T(),S()];return(await Promise.all(t)).reduce((e,t)=>Object.assign(e,t))},requestAccessToken:async function(t,n){var i={scope:t,response_type:"token"};n&&n.email&&(i.login_hint=n.email);var o=E(i),a=new URL(d);a.search=o.toString();var s=await p().navigateToAuthEndpoint(a.href,r,!0);return s&&s.access_token?s:(e.info("failed to get token from iframe for resource "+t),Promise.reject("unable to retrieve result from "+a.href))}}}]).factory("userService",["$q","$log","$injector","storage","notification","msaUserService","o365UserService","msidUserService",function(e,t,n,r,i,o,s,l){async function d(e,n,r){var i={};if(!(i=await O(e)))return t.error("userService.acquireToken - Invalid type"),Promise.reject("Invalid userType");!r&&i.getResourceForEndpoint&&(r=i.getResourceForEndpoint(n));var o={};try{if((o=await y(n,r))&&o.access_token&&!D(o.expires_on))return t.debug(`Using cached token with resource:'${r}'${n?" for "+n:""} `),o.access_token;if(!(o=await async function(e,n){if(!e)return t.error("userService.requestAccessToken - Invalid type"),Promise.reject("Invalid userType");const r=await async function(){return C("refresh_token")}();if(r)return async function(e,n,r){if(!e)return t.error("userService.refreshAccessToken - Invalid type"),Promise.reject("Invalid userType");var i=e.getConfig();i.params.grant_type=u.a.OAUTH.REFRESH_TOKEN,i.params.resource=n,i.params.refresh_token=r;var o={method:"POST",url:i.tokenUrl,headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8"},data:new URLSearchParams(i.params).toString()};return await f(o)}(e,n,r);const i=await m();var o=await A(i);if(e.requestAccessToken)var a=await e.requestAccessToken(n,o);return a}(i,r)))return Promise.reject("No tokens available");w(i,n,o)}catch(i){t.error(`userService.acquireToken - failed. reason: ${i}, userType: ${e}, endpoint: ${n}, resource: ${r}`)}return o&&o.access_token&&o.expires_on&&!D(o.expires_on)?o.access_token:null}async function f(e){if(!e)return Promise.reject("Invalid Request");var t=(new Error).stack,r=new Promise((r,i)=>{n.get("$http")(e).then(e=>{r(e.data)},n=>{i(`httpRequest failed for url: ${e.url} reason: ${n.statusText} stack:\n ${t}`)})});return await r}async function p(e){const n=e.type;var r=void 0,o=await O(n),a=!1;if(o){if(e.code){r=n.userType;try{a=!!await async function(e,n){if(!e)return t.error("userService.acquireTokenFromCode - Invalid type"),void Promise.reject("Invalid userService type");var r=e.getConfig();r.params.grant_type=u.a.OAUTH.AUTH_CODE,r.params.code=n;var i={method:"POST",url:r.tokenUrl,headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8"},data:new URLSearchParams(r.params).toString()};const o=await f(i);return await w(e,e.getConfig().resource,o),await b(e,o),o.access_token}(o,e.code)}catch(e){r===u.a.USER_TYPE.O365&&i.show(u.a.NOTIFICATION.INVALIDSUBSCRIPTION)}}else e.id_token&&(r=await T(e.id_token)),e.access_token&&(await w(o,o.getConfig().userInfoUrl,e),r||(r=await m()),await b(o,e.id_token)),a=r!==u.a.USER_TYPE.NONE;return e.error&&("interaction_required"===e.error?g(await m(),!1):t.error(`userService.authenticate - authentication returned error: ${e.error} description: ${e.error_description} request: ${JSON.stringify(e)}`)),t.trackEvent("Authorization",{userType:r,serviceType:n,succeeded:a}),a?Promise.resolve():Promise.reject()}t.error("userService.authenticate - Invalid type")}async function E(){return Promise.all([r.remove("accessToken"),r.remove("refreshToken"),r.remove("userInfo"),r.remove("userType"),r.remove("identity")])}async function m(){return(await r.get("userType")).userType||u.a.USER_TYPE.NONE}async function T(e){var n="";if(Object.values(u.a.USER_TYPE).includes(e))n=e;else{var i=function(e){var n=e.scopes||e.scope;if(n&&n.includes("wl."))return{type:u.a.USER_TYPE.MSA};var r=e.id_token||e;if(!r)return{type:u.a.USER_TYPE.NONE};const i={"9188040d-6c67-4c5b-b112-36a304b66dad":{type:u.a.USER_TYPE.MSA,audience:"prod"},"4925308c-f164-4d2d-bc7e-0631132e9375":{type:u.a.USER_TYPE.MSA,audience:"ppe"},"72f988bf-86f1-41af-91ab-2d7cd011db47":{type:u.a.USER_TYPE.O365,audience:"prod",domain:"microsoft.com"},"f686d426-8d16-42db-81b7-ab578e110ccd":{type:u.a.USER_TYPE.O365,audience:"ppe",domain:"microsoft.com"}};try{const{header:e,payload:n}=function(e){var n=/^([^.\s]*)\.([^.\s]+)\.([^.\s]*)$/.exec(e);if(!n||n.length<4)return t.error("userService.parseJwtToken - The returned id_token is not parseable."),null;var r=JSON.parse(M(n[1])),i=JSON.parse(M(n[2]));return{header:r,payload:i}}(r);var o={tenant:n.tid};if(i.hasOwnProperty(o.tenant)){var a=i[o.tenant];o=Object.assign(o,a)}else o.type=u.a.USER_TYPE.O365;return o}catch(e){return{type:u.a.USER_TYPE.MSA}}}(e);n=i.type,delete i.type;var o={[n]:i},a=await U();R(a,o),await r.set({identity:a})}return n!==u.a.USER_TYPE.NONE&&await r.set({userType:n}),n}function S(e){e.state&&(e.state=decodeURIComponent(e.state));var[t,n,r]=e.state.split("|");return n&&(e.type=n),e}async function N(e,n,r){return new Promise(async(i,o)=>{if(a.a.isBackgroundContext()){const a=(e=new URL(e)).searchParams;for(const e of["state","nonce"]){var s=a.get(e);s||(s=x()),"state"===e&&n&&(s+="|"+n+"|"+u.a.APPINFO_NAME),a.set(e,s)}var l=void 0,d=void 0;function f(){if(c.a.runtime.onMessage.removeListener(E),l){var e=document.getElementById(l);e&&e.parentNode.removeChild(e)}}const T=a.get("state"),N=a.get("scope");t.info(`loading auth url:${e.href} ${r?"in iframe":""}`);var p=await A();function E(n,r,a){if(r.id===c.a.runtime.id){if(n.activity===u.a.ACTIVITY.AUTHORIZATION.NAME){var s=S(n);s||(t.error(`userService.listener - auth url:${e} returned null response `),o(s)),s.state!==T&&t.warn(`userService.listener - auth url:${e} mismatched state:${s.state}`),t[s.error?"error":"debug"](`userService.listener - auth response:${JSON.stringify(s)} received from url:${e}`),d&&clearTimeout(d),delete s.activity,f(),i(s)}}else t.debug("auth listener rejected invalid id: "+r.id)}if(p&&p.email&&!a.has("login_hint")&&a.set("login_hint",p.email),c.a.runtime.onMessage.addListener(E),r){a.set("prompt","none"),l="authFrame!"+N;const n=6e4;d=setTimeout(()=>{t.warn(`userService.authInFrame timed out waiting for ${e.toString()} after ${n} ms`),f(),o("Timed out waiting for response from iFrame")},n);var m=document.getElementById(l);m||((m=document.createElement("iframe")).setAttribute("id",l),m.style.visibility="hidden",m.style.position="absolute",m.style.width=m.style.height="0",m.style.border="0",m.setAttribute("sandbox","allow-scripts allow-same-origin allow-forms"),document.body.appendChild(m),m.src=e.toString())}else c.a.tabs.create({url:e.toString()})}else c.a.runtime.sendMessage({activity:"requestToken",data:{url:e,type:n,inIFrame:r}},e=>{i(e)})})}async function g(e,n=!0){!0===n&&E();var r=await O(e);if(r.handleLogin)return r.handleLogin();var i=r.getConfig().loginUrl;if(i)return N(i,r.type);t.error("userService.login - Invalid type")}async function h(){const e=await m();var n=await O(e);if(E(),n.handleLogout)await n.handleLogout();else{var r=n.getConfig().logoutUrl;if(!r)return void t.error("userService.logout - Invalid type");var i={method:"GET",url:r};await f(i)}t.debug("userService.logout - "+e)}async function I(e){return void 0!==e&&r.set({authNext:{override:e}}),v({noLogout:!0})}async function v(e){var n=new Date;const i=n.toUTCString();var o=await r.get("authNext");n=Math.round(n/1e3);var s=0;if(o.authNext&&o.authNext.lastCheck&&a.a.isNotUndefinedOrNull(o.authNext.flighted)&&(s=n-o.authNext.lastCheck,(!e||!0!==e.force)&&s<864e5&&o.authNext.flighted))return o.authNext.flighted;t.info("checkTransitionAuth time:"+i);var c=await(async()=>{var e={url:"https://nleditor.osi.office.net/NLEditor/api/V1/BrowserExtension",method:"POST",accept:"application/json",contentType:"application/json",headers:{"X-UserId":await async function(){var e=await r.get("deviceId");if(e.deviceId)return e.deviceId;var t=x();return await r.set({deviceId:t}),t}()},data:{AppId:"OfficeBX_Online"}},n={};try{n=await f(e)}catch(e){t.error("userService.checkAuthFlighting - Call to editor service failed. error:"+JSON.stringify(e))}var i=!1;if(n&&n.FeatureFlags&&n.FeatureFlags.authNext){var o=n.FeatureFlags.authNext;i="string"==typeof o?"true"===o.toLowerCase():!!o}return t.info("editor featureFlags.authNext returned:"+i),i})();if(await r.set({authNext:{flighted:c,lastCheck:n}}),o.authNext&&a.a.isNotUndefinedOrNull(o.authNext.override))return t.info("using authNext override from local storage."),o.authNext.override;var l=await C("service");c!==(l===u.a.USER_SERVICE_TYPE.MSID)&&(t.trackEvent("AuthNext",{elapsed:s,authNext:c,serviceType:l}),e&&!e.noLogout&&await h())}async function O(e){var n=null;return Object.values(u.a.USER_SERVICE_TYPE).includes(e)||(e=await async function(e){var t=await C("service",e);if(t)return t;if(t=u.a.USER_SERVICE_TYPE.NONE,await I())return u.a.USER_SERVICE_TYPE.MSID;switch(e){case u.a.USER_TYPE.MSA:t=u.a.USER_SERVICE_TYPE.MSA;break;case u.a.USER_TYPE.O365:t=u.a.USER_SERVICE_TYPE.O365}return t}(e)),-1!==e.indexOf(u.a.USER_SERVICE_TYPE.MSA)?n=o:-1!==e.indexOf(u.a.USER_SERVICE_TYPE.O365)?n=s:-1!==e.indexOf(u.a.USER_SERVICE_TYPE.MSID)?n=l:t.error("userService.getServiceProvider - Invalid type - "+e),n}async function U(){var e=await r.get("identity");return e&&e.identity?e.identity:{}}function R(e,n){for(var[r,i]of Object.entries(n))i&&(e[r]&&"none"!==e[r]&&"none"!==i?typeof i==typeof e[r]?Array.isArray(i)?i.forEach(t=>{e[r].indexOf(t)<0&&e[r].push(t)}):"object"!=typeof i?e[r]=i:R(e[r],i):t.warn(`skipping ${r} due to conflicting types`):e[r]=i)}function _(e){return new URL(e).origin}async function w(e,n,i){if(i.expires_in&&!i.expires_on&&(i.expires_on=a.a.getCurrentTime()+Number(i.expires_in)),n){var o=await m();if(o===u.a.USER_TYPE.NONE&&(o=await T(i)),o!==u.a.USER_TYPE.NONE){var s=decodeURIComponent(i.scope).toLowerCase().split(/[ +]/);for(const e of s){var c=e.match(/(^https:\/\/[.\w]*(?:\S+\/))/i);if(c){n=c[c.index];break}}n=_(n),i.resource&&i.resource!==n&&(t.info(`saveTokens ${n} does not match ${i.resource}`),n=i.resource);var l={[o]:{id_token:i.id_token,refresh_token:i.refresh_token,service:e.type,resources:{[n]:{access_token:i.access_token,expires_in:i.expires_in,expires_on:i.expires_on,scope:s}}}},d=await U();R(d,l),await r.set({identity:d})}else t.error("userService.saveTokens - unable to resolve userType")}else t.error("userService.saveTokens - endpoint not provided")}function P(e,t){if(!e)return!0;if(!t)return!1;Array.isArray(e)||(e=e.toLowerCase().split(/[ +]/));for(const n of e)if(!t.includes(n))return!1;return!0}async function y(e,n){if(e){e=_(e);try{var r=await C("resources");if(r[e]){var i=r[e];if(e===n)return i;if(i&&P(n,i.scope))return i;delete r[e]}for(const e in r)if(P(n,e.scope))return e;return null}catch(e){return null}}else t.error("userService.getAccessToken - endpoint not provided")}async function A(e){return C("userInfo",e)}async function C(e,t){t||(t=await m());var n=await U();return n[t]&&n[t][e]?n[t][e]:null}async function L(e,t,n){var i=await U(),o={};i[e]&&i[e].userInfo&&!n&&(o=i[e].userInfo),R(o,t),i[e]&&(i[e].userInfo=o,await r.set({identity:i}))}function D(e){var t=a.a.getCurrentTime();return!(e&&e>t+120)}async function b(e,t){var n=await m(),r=await e.lookupUserInfo(t);c.a.runtime.sendMessage({activity:u.a.ACTIVITY.USERINFO_AVAILABLE.NAME,data:r}),!r.email&&r.userPrincipalName&&(r.email=r.userPrincipalName),await L(n,r,!0),await k(e)}function M(e){return e=e.replace(/-/g,"+").replace(/_/g,"/"),decodeURIComponent(escape(window.atob(e)))}async function k(e){const n=e.type,r=await m();var i=e.getConfig().photoUrl;if(i){var o={method:"GET",url:i,responseType:"blob",headers:{"X-UserType":n}};try{const e=await f(o);t.trackEvent("UserService_GotServerPhoto",{userType:r});var a=new FileReader;a.onload=async()=>(L(r,{photo:a.result}),a.result),a.readAsDataURL(e)}catch(e){return null}}}function x(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){let t=performance.now();const n=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"===e?n:3&n|8).toString(16)}))}return a.a.isBackgroundContext()&&c.a.runtime.onMessage.addListener((function(e,t,n){switch(e.activity){case u.a.ACTIVITY.LOGOUT.NAME:return h().then(()=>{n()}),!0;case u.a.ACTIVITY.AUTHENTICATION.NAME:return g(e.type).then(e=>{n(e)}),!0;case u.a.ACTIVITY.AUTHORIZATION.NAME:return t.id===c.a.runtime.id&&e.close&&(t.tab&&t.tab.id&&c.a.tabs.remove(t.tab.id),delete e.close),p(S(e)).then(()=>{n()}),!0;case u.a.ACTIVITY.REQUEST_TOKEN.NAME:return N(e.data.url,e.data.type,e.data.inIFrame).then(e=>{n(e)}),!0;default:return}})),window.useAuthNext=I,window.checkTransitionAuth=v,a.a.isBackgroundContext()&&async function(){t.debug("initCheckTransition"),await v(),setInterval(v,864e5)}(),{acquireToken:d,clearToken:E,isLoggedIn:async function(){var e=await r.get(["userType","identity"]);return e.identity&&e.userType&&e.userType!==u.a.USER_TYPE.NONE},getEndpointUrlForCurrentUser:async function(e){const t=await m();if(!t||t===u.a.USER_TYPE.NONE)return null;var n=await O(t);return n?n.getConfig()[e]:null},getUserType:m,getUserInfo:A,getUserPhoto:async function(){var e=await m();if(e===u.a.USER_TYPE.NONE)return t.warn("UserService.getUserPhoto: no signed-in user"),Promise.reject(u.a.RECENTS.ERROR.UNSUPPORTED_USER_TYPE);var n=await A(e);return n&&n.photo?(t.trackEvent("UserService_GotLocalPhoto",{userType:e}),n.photo):Promise.reject("No photo in local storage")},httpRequest:f,navigateToAuthEndpoint:N,saveUserInfo:L,waitForUserInfo:async function(e){return new Promise(async n=>{var r=await A(e);if(a.a.isNotUndefinedOrNull(r))return n(r);c.a.runtime.onMessage.addListener(s);var i=a.a.isExtensionInTestingMode()?u.a.TIMEOUT.USER_INFO_LOOKUP_TEST:u.a.TIMEOUT.USER_INFO_LOOKUP,o=setTimeout(()=>{t.warn(`userService.waitForUserInfo timed out after ${u.a.TIMEOUT.USER_INFO_LOOKUP} ms - ${e}`),l(),n(r)},i);function s(e){e.activity===u.a.ACTIVITY.USERINFO_AVAILABLE.NAME&&(l(),clearTimeout(o),n(e.data))}function l(){c.a.runtime.onMessage.removeListener(s)}})},getUserLicenseInfo:async function(){var e=await A();return["driveQuota","licenses"].reduce((t,n)=>(e[n]&&(t[n]=e[n]),t),{})},useAuthNext:I,authorize:p,getAccessToken:y,getPhotoFromServer:k,login:g,logout:h,lookupUserInfo:b}}]).name},37:function(e,t,n){e.exports=n(69)},69:function(e,t,n){"use strict";n.r(t);var r=n(3),i=n.n(r),o=(n(25),n(26),n(7),n(24),n(1)),a=n.n(o),s=n(0),c=function(e,t,n,r){async function i(e,t){return new Promise((r,i)=>{n({method:"GET",accept:"application/json",url:t,contentType:"application/json",headers:{"X-UserType":e}}).then((function(e){r(e.data)}),(function(){i(s.a.RECENTS.ERROR.GENERIC)}))})}async function o(e,t){var r={method:"GET",accept:"application/json",url:"https://graph.microsoft.com/v1.0/me/drive/items/"+t,contentType:"application/json",headers:{"X-UserType":e}};try{return new Promise(e=>{n(r).then((function(t){e(t.data)}))})}catch(e){return Promise.resolve({})}}async function c(e){var t={method:"GET",accept:"application/json",url:"https://graph.microsoft.com/v1.0/me/drive/sharedWithMe",contentType:"application/json",headers:{"X-UserType":e}};return new Promise(e=>{try{n(t).then((function(t){e(t.data)}))}catch(t){e({})}})}const u={"application/vnd.openxmlformats-officedocument.wordprocessingml.document":"word","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":"excel","application/vnd.openxmlformats-officedocument.presentationml.presentation":"powerpoint","application/msonenote":"onenote"};function l(e){var t=[];if(a.a.isUndefinedOrNull(e))return t;for(const f of e){if(f.DocumentUrl&&f.Timestamp&&f.Application&&f.FileName){t.push(f);continue}if(!f.remoteItem)continue;const e=f.name||f.remoteItem.name,p=f.id||f.remoteItem.id;if(e&&p){var n=f.remoteItem,r=void 0,i=void 0,o=void 0;if(n.mru){var c=n.mru;c.app&&-1!==s.a.FILE.SUPPORTED_APPLICATIONS.indexOf(c.app)&&(r=c.url,i=c.timeStamp,o=c.app.toLowerCase())}else{if(!(r=n.webDavUrl||n.webUrl))continue;const t=s.a.FILE.SUPPORTED_FILE_TYPES;var l=a.a.getFileExtension(r)||a.a.getFileExtension(e);if(t.hasOwnProperty(l))o=t[l];else if(n.file&&n.file.mimeType&&u.hasOwnProperty(n.file.mimeType))o=u[n.file.mimeType];else if(!o){var d=n.package||f.package;if(!d||!d.type)continue;if(o=d.type.toLowerCase(),!Object.values(t).includes(o))continue}if(!o)continue;if(n.lastModifiedDateTime?i=n.lastModifiedDateTime:n.fileSystemInfo&&(i=n.fileSystemInfo.lastAccessedDateTime||n.fileSystemInfo.lastModifiedDateTime),!i)continue}t.push({DocumentUrl:r,Timestamp:i,Application:o,FileName:e,Id:p})}}return t}return{getRecentDocumentList:async function(){const e=await r.getUserType();if(e===s.a.USER_TYPE.NONE)return Promise.reject(s.a.RECENTS.ERROR.UNSUPPORTED_USER_TYPE);const t=await r.getEndpointUrlForCurrentUser("documentsUrl");var n=await i(e,t);return await async function(e,t){if(t.value){var n=void 0;for(var r of t.value)if(!Object.values(r.remoteItem).length){if(!n){var i=await c(e);if(!i.value)return;n=i.value}var a=n.find(e=>e.remoteItem&&e.remoteItem.id&&e.remoteItem.id.toLowerCase()===r.id.toLowerCase());if(a)r.remoteItem=a.remoteItem;else{var s;try{s=await o(e,r.id)}catch(e){continue}s&&s.id&&(r.remoteItem.webUrl=s.webUrl,r.name=s.name,r.file||(r.file=s.file),r.remoteItem.package||(r.remoteItem.package=s.package),r.remoteItem.lastModifiedDateTime||(r.remoteItem.lastModifiedDateTime=s.lastModifiedDateTime))}}}}(e,n),l(n.data||n.value||n)},getRecentDocs:i,normalizeMruList:l}};var u=function(e,t,n,r,i){var o=this;o.onLoad=function(){n.debug("Loading MruController"),o.currentDisplayPanel=o.constants.RECENTS.DISPLAY_PANEL.LOADING,o.getRecentDocumentsFromStorage().then((function(e){!a.a.isUndefinedOrNull(e)&&e.length>0&&(o.recentDocuments=e,o.currentDisplayPanel=o.constants.RECENTS.DISPLAY_PANEL.LIST)}))},o.openRecentDocument=function(e,t){n.trackEvent("PopupOpenRecentDocument",{application:e.application}),a.a.navigateToUrlWithNewTab(e.url,!(!a.a.isUndefinedOrNull(t)&&!a.a.isUndefinedOrNull(t.ctrlKey)&&t.ctrlKey)),window.close()},o.constants=s.a,o.storage=r,o.currentDisplayPanel=o.constants.RECENTS.DISPLAY_PANEL.LOADING,o.recentDocuments=[],o.LIST_LENGTH=o.constants.RECENTS.LIST_LENGTH_MSA,e.$watch("userType",(function(e){e!==o.constants.USER_TYPE.NONE&&(o.LIST_LENGTH=e===o.constants.USER_TYPE.O365?o.constants.RECENTS.LIST_LENGTH_O365:o.constants.RECENTS.LIST_LENGTH_MSA,o.refreshRecentDocumentsList().then((function(){o.currentDisplayPanel=!a.a.isUndefinedOrNull(o.recentDocuments)&&o.recentDocuments.length>0?o.constants.RECENTS.DISPLAY_PANEL.LIST:o.constants.RECENTS.DISPLAY_PANEL.NO_DOCS}),(function(e){n.debug("MruController $scope.$watch error on refreshRecentDocumentsList: "+e),o.currentDisplayPanel=!a.a.isUndefinedOrNull(o.recentDocuments)&&o.recentDocuments.length>0?o.constants.RECENTS.DISPLAY_PANEL.LIST:o.constants.RECENTS.DISPLAY_PANEL.ERROR})))})),this.refreshRecentDocumentsList=function(){var e=t.defer();return n.debug("MruController.refreshRecentDocumentsList(): Method start"),i.getRecentDocumentList().then((function(t){a.a.isUndefinedOrNull(t)&&(t=[]);for(var r=[],i=0,s=0;s<t.length&&i<o.LIST_LENGTH;s++)a.a.isUndefinedOrNull(t[s].Application)?n.warn("Undefined document application with document type "+a.a.getFileExtension(t[s].FileName)):o.isFileDataValid(t[s].FileName,t[s].Application,t[s].DocumentUrl,t[s].Timestamp)&&(r.push({appLabel:o.constants.FILE.APPLICATION_LABEL[t[s].Application.toLowerCase()],application:t[s].Application,lastAccessed:new Date(t[s].Timestamp).toLocaleDateString(),imageSource:"../"+o.constants.FILE.APPLICATION_IMAGE_PATH[t[s].Application.toLowerCase()],name:o.shortenFilename(t[s].FileName),url:o.createOpenInWebUrl(t[s].DocumentUrl),id:t[s].Id}),i++);o.mruListsEqual(o.recentDocuments,r)||(o.recentDocuments=r,o.setRecentDocumentsToStorage(r)),e.resolve()}),(function(t){e.reject(t)})),e.promise},this.mruListsEqual=function(e,t){if(a.a.isUndefinedOrNull(e)||a.a.isUndefinedOrNull(t)||e.length!==t.length)return!1;for(var n=0;n<t.length;n++)if(t[n].name!==e[n].name||t[n].url!==e[n].url||t[n].lastAccessed!==e[n].lastAccessed)return!1;return!0},this.getRecentDocumentsFromStorage=function(){var e=t.defer();return r.get("localRecentDocuments").then((function(t){e.resolve(t.localRecentDocuments)})),e.promise},this.setRecentDocumentsToStorage=function(e){r.set({localRecentDocuments:e})},this.isFileDataValid=function(e,t,n,r){return!(a.a.isUndefinedOrNull(t)||!o.constants.FILE.APPLICATION_LABEL[t.toLowerCase()])&&(a.a.isNotUndefinedOrNull(e)&&a.a.isNotUndefinedOrNull(n)&&a.a.isNotUndefinedOrNull(r))},this.createOpenInWebUrl=function(e){return o.constants.FILE.SUPPORTED_FILE_TYPES[a.a.getFileExtension(e)]?e+"?web=1":e},this.shortenFilename=function(e){return e.replace(/\.[^/.]+$/,"")}};i.a.module("app.mru",[]).factory("mruService",["$q","$log","$http","userService",c]).controller("MruController",["$scope","$q","$log","storage","mruService",u]).name,n(14),n(33);var l=n(2),d=n.n(l),f=n(36),p=n.n(f);i.a.module("app.popup",["ngRoute"]).controller("PopupController",["$timeout","$scope","$q","$log","$document","storage","userService","localize","notification",function(e,t,n,r,i,o,c,u,l){var f=this;function E(){r.trackEvent("PopupSignOutLinkClick"),d.a.runtime.sendMessage({activity:s.a.ACTIVITY.LOGOUT.NAME,type:t.userType}),f.hasSignedIn=s.a.SIGNINSTATUS.NONE,t.userType=s.a.USER_TYPE.NONE,o.remove("localRecentDocuments")}async function m(){r.trackEvent("PopupOpenDocument",{userType:t.userType});var e=await f.userService.getUserInfo(t.userType);a.a.isUndefinedOrNull(e)?r.warn("PopupController.openDocument(): invalid userInfo"):a.a.isUndefinedOrNull(e.oneDriveUrl)?r.warn("PopupController.openDocument(): invalid OneDriveUrl"):a.a.navigateToUrlWithNewTab(e.oneDriveUrl,!0)}function T(){return t.userType===s.a.USER_TYPE.O365}f.accountPanelOpened=!1,f.filesSelected=null,f.webRedirectInputChecked=!1,f.telemetryInputChecked=!1,f.onLine=!0,f.username="",f.profilePicture="",f.rtl=a.a.isRTL(),f.isChrome=a.a.isChrome(),f.useAuthNext=!1,f.editorFeatureEnabled=a.a.isEditorEnabled(),f.appDescriptionMessage=u.getLocalizedString("AppDescription"),f.onMenuItemClick=function(e){f.currentViewMode=f.currentViewMode===e?s.a.MENU_VIEWMODE.NONE:f.currentViewMode=e},f.onSignOutClick=function(){f.currentViewMode=s.a.MENU_VIEWMODE.NONE,f.hasSignedIn===s.a.SIGNINSTATUS.SIGNEDIN&&E()},f.onWelcomeSignInClick=async function(e){return r.trackEvent("PopupSignInLinkClick"),window.close(),new Promise(async t=>{d.a.runtime.sendMessage({activity:s.a.ACTIVITY.AUTHENTICATION.NAME,type:e},e=>{t(),r.debug("onWelcomeSignInClick sendMessage returned "+e)})})},f.onProfileClick=function(){f.accountPanelOpened=!f.accountPanelOpened},f.onSignOutLinkClick=E,f.onSignupLinkClick=function(){r.trackEvent("PopupSignupLinkClick"),a.a.navigateToUrlWithNewTab(s.a.LINKS.SIGNUP,!0)},f.onWebRedirectInputChange=function(){f.webRedirectInputChecked=!f.webRedirectInputChecked,f.storage.set({webRedirect_disabled:!f.webRedirectInputChecked}),r.trackEvent("PopupWebRedirectChecked",{enabled:f.webRedirectInputChecked})},f.onTelemetryInputChange=function(){f.telemetryInputChecked=!f.telemetryInputChecked,r.setEnabledSetting(f.telemetryInputChecked),r.trackEvent("PopupTelemetryInputChecked",{enabled:f.telemetryInputChecked})},f.onFileInputChange=function(){f.loadFile(),r.trackEvent("PopupFileInputChange")},f.openDocument=m,f.openOfficeHome=function(){a.a.navigateToUrlWithNewTab(s.a.LINKS.OFFICE_HOME_URL,!0)},f.openSupportPage=function(){var e=a.a.shouldShowEditorMaterial()?s.a.LINKS.SUPPORT_URL_EDITOR:s.a.LINKS.SUPPORT_URL;a.a.navigateToUrlWithNewTab(e,!0)},f.openMyAccountPage=function(){var e=T()?s.a.LINKS.MYACCOUNT_O365_URL:s.a.LINKS.MYACCOUNT_MSA_URL;a.a.navigateToUrlWithNewTab(e,!0)},f.browseToRecents=async function(){r.trackEvent("PopupBrowseToRecents",{userType:t.userType});var e=await f.userService.getUserInfo(t.userType);if(a.a.isUndefinedOrNull(e))return void r.warn("PopupController.browseToRecents(): invalid userInfo");if(a.a.isUndefinedOrNull(e.oneDriveUrl))return void r.warn("PopupController.browseToRecents(): invalid OneDriveUrl");var n=new URL(e.oneDriveUrl);if(!T()){var i=new URLSearchParams(n.search);i.append("qt","mru"),n.search=i.toString()}a.a.navigateToUrlWithNewTab(n.toString(),!0)},f.createDocument=function(e,n){var i;if(r.trackEvent("PopupCreateDocument",{application:e.id}),"OneDrive"===e.id)return void m();if("Outlook"===e.id)i=T()?s.a.LINKS.APP.OUTLOOK_O365:s.a.LINKS.APP.OUTLOOK_DEFAULT;else{if("SharePoint"===e.id)return void async function(){var e=await f.userService.getUserInfo(t.userType);if(a.a.isNotUndefinedOrNull(e)&&a.a.isNotUndefinedOrNull(e.sharePointUrl))return void a.a.navigateToUrlWithNewTab(e.sharePointUrl,!0);r.warn("PopupController.openDocument(): invalid sharePointUrl"),a.a.navigateToUrlWithNewTab(s.a.LINKS.APP.SHAREPOINT_DEFAULT,!0)}();if("function"==typeof e.url){const t=f.hasSignedIn!==s.a.SIGNINSTATUS.SIGNEDIN?"0":T()?"2":"1";i=e.url(t)}else i=e.url}a.a.navigateToUrlWithNewTab(i,!(!a.a.isUndefinedOrNull(n)&&!a.a.isUndefinedOrNull(n.ctrlKey))||!n.ctrlKey)},f.handleTableNavigation=function(e){var t=e.which||e.keyCode||0;if(![s.a.JQUERY.EVENT_ID.KEYPRESS.ARROWLEFT,s.a.JQUERY.EVENT_ID.KEYPRESS.ARROWUP,s.a.JQUERY.EVENT_ID.KEYPRESS.ARROWRIGHT,s.a.JQUERY.EVENT_ID.KEYPRESS.ARROWDOWN].includes(t))return;var n=e.target.closest(".app_table_cell"),r=n.closest(".app_table_row");if(!n||!r)return;var i,o=n.previousElementSibling;switch(t){case s.a.JQUERY.EVENT_ID.KEYPRESS.ARROWLEFT:i=n.previousElementSibling;break;case s.a.JQUERY.EVENT_ID.KEYPRESS.ARROWUP:var a=r.previousElementSibling;a&&(i=a.querySelector(".app_table_cell")),o&&i&&(i=i.nextElementSibling);break;case s.a.JQUERY.EVENT_ID.KEYPRESS.ARROWRIGHT:i=n.nextElementSibling;break;case s.a.JQUERY.EVENT_ID.KEYPRESS.ARROWDOWN:var c=r.nextElementSibling;c&&(i=c.querySelector(".app_table_cell")),o&&i&&(i=i.nextElementSibling)}i&&(e.preventDefault(),i.querySelector("button").focus())},f.loadFile=function(){r.trackEvent("PopupLoadFile",{filesSelectedCount:f.filesSelected.length}),f.filesSelected.length>1&&r.warn(`loadFile called with ${f.filesSelected.length} files selected`);if(!s.a.FILE.SUPPORTED_FILE_TYPES[a.a.getFileExtension(f.filesSelected[0].name)])return r.info(`PopupController.loadFile(): User attempted to open an unsupported file type of ${a.a.getFileExtension(f.filesSelected[0].name)} extension`),void l.show(s.a.NOTIFICATION.UNSUPPORTEDFILETYPE);e=f.filesSelected[0],d.a.extension.getBackgroundPage().postMessage(e,window.location);var e},f.constants=s.a,f.storage=o,f.userService=c,f.localize=u,f.hasSignedIn=s.a.SIGNINSTATUS.UNKNOWN,f.currentViewMode=s.a.MENU_VIEWMODE.NONE,t.userType=s.a.USER_TYPE.NONE,f.appLaunchers=[[{id:"Outlook",label:"OutlookAppName",iconClass:"ms-BrandIcon--icon48 ms-BrandIcon--outlook",url:s.a.LINKS.APP.OUTLOOK_DEFAULT,isBusinessOnly:!1},{id:"OneDrive",label:"OneDriveAppName",iconClass:"ms-BrandIcon--icon48 ms-BrandIcon--onedrive",url:s.a.LINKS.APP.ONEDRIVE,isBusinessOnly:!1}],[{id:"WordOnline",label:"WordAppName",iconClass:"ms-BrandIcon--icon48 ms-BrandIcon--word",url:s.a.LINKS.APP.WORD,isBusinessOnly:!1},{id:"ExcelOnline",label:"ExcelAppName",iconClass:"ms-BrandIcon--icon48 ms-BrandIcon--excel",url:s.a.LINKS.APP.EXCEL,isBusinessOnly:!1}],[{id:"PowerPointOnline",label:"PowerPointAppName",iconClass:"ms-BrandIcon--icon48 ms-BrandIcon--powerpoint",url:s.a.LINKS.APP.POWERPOINT,isBusinessOnly:!1},{id:"OneNoteOnline",label:"OneNoteAppName",iconClass:"ms-BrandIcon--icon48 ms-BrandIcon--onenote",url:s.a.LINKS.APP.ONENOTE,isBusinessOnly:!1}],[{id:"SharePoint",label:"SharePointSiteAppName",iconClass:"ms-BrandIcon--icon48 ms-BrandIcon--sharepoint",url:s.a.LINKS.APP.SHAREPOINT_DEFAULT,isBusinessOnly:!0},{id:"Teams",label:"TeamsAppName",iconClass:"ms-BrandIcon--icon48 ms-BrandIcon--teams",url:s.a.LINKS.APP.TEAMS,isBusinessOnly:!0}]],i.ready((function(){e((function(){r.trackEvent("PopupPageLoad")}));for(var t=document.querySelectorAll(".ms-CheckBox"),n=0;n<t.length;n++)new p.a.CheckBox(t[n])})),o.get(["userType","identity"]).then(e=>{var n=e&&e.identity&&e.userType!==s.a.USER_TYPE.NONE;return f.hasSignedIn=n?s.a.SIGNINSTATUS.SIGNEDIN:s.a.SIGNINSTATUS.NONE,f.hasSignedIn>s.a.SIGNINSTATUS.NONE&&(r.debug("PopupController.refreshSignInStatus(): Method start"),f.userService.getUserType().then((async function(e){if(r.debug("PopupController.getSignInStatus(): hasSignedIn: "+e),r.trackEvent("PopupSignedIn",{userType:e}),t.userType=e,f.hasSignedIn=e===s.a.USER_TYPE.NONE?s.a.SIGNINSTATUS.NONE:s.a.SIGNINSTATUS.SIGNEDIN,f.hasSignedIn===s.a.SIGNINSTATUS.SIGNEDIN){var n=await f.userService.waitForUserInfo(e);a.a.isUndefinedOrNull(n)?r.warn("self.UserService.getUserInfo(): userInfo is undefined or null when hasSignedIn is SIGNINSTATUS.SIGNEDIN"):a.a.isUndefinedOrNull(n.email)?r.warn("self.UserService.getUserInfo(): userInfo.email is undefined or null when hasSignedIn is SIGNINSTATUS.SIGNEDIN"):(f.username=n.email,c.getUserPhoto().then((function(e){e&&(f.profilePicture=e)}),(function(e){f.profilePicture="",r.info("PopupController.getUserPhoto: Profile Picture Error - "+e)})))}}))),f.storage.get("webRedirect_disabled")}).then(e=>(f.webRedirectInputChecked=!(a.a.isNotUndefinedOrNull(e.webRedirect_disabled)&&e.webRedirect_disabled),r.getEnabledSetting())).then(e=>(r.setEnabledSetting(e),f.telemetryInputChecked=e,c.useAuthNext())).then(e=>{f.useAuthNext=e})}]).directive("bindFileChange",(function(){return{require:"ngModel",restrict:"A",link:function(e,t,n,r){t.bind("change",(function(e){r.$setViewValue(e.target.files)}))}}})).directive("bindDragAndDrop",["$log",function(e){return{require:"ngModel",restrict:"A",link:function(t,n,r,i){n.bind("dragover",(function(e){e.stopPropagation(),e.preventDefault(),e.originalEvent.dataTransfer.dropEffect="copy"})),n.bind("drop",(function(t){t.stopPropagation(),t.preventDefault(),e.trackEvent("OpenDocument_Local_AppDragAndDrop"),i.$setViewValue(t.originalEvent.dataTransfer.files)}))}}}]).directive("bindFileInputContainerClick",["$log",function(e){return{restrict:"A",link:function(t,n){n.bind("mousedown keydown keypress",(function(t){t.which!==s.a.JQUERY.EVENT_ID.MOUSEDOWN.LEFT_BUTTON_CLICK&&t.which!==s.a.JQUERY.EVENT_ID.KEYPRESS.ENTER||(e.trackEvent("OpenDocument_Local"),t.currentTarget.nextElementSibling.click(),t.preventDefault())}))}}}]).config(["$routeProvider",e=>{e.when("/",{templateUrl:"./popup/popup.html",controller:"PopupController",controllerAs:"ctrl"}).otherwise({redirectTo:"/"})}]).name;i.a.module("app.experimentation",[]).constant("experimentConstants",{DEFAULT_CLIENT_ID:"",ENABLED:{MSA:!0,O365:!1,BROWSERS:["Chrome","Edge"]},ENDPOINT:"http://officeonlineextension-office365.msedge.net/ab",ERROR:{BAD_USER_TYPE:"badUserType",NO_CLIENT_ID:"noClientId",NO_FEATURES:"noFeatures"},EXPERIMENTS:{SHARING:{ENABLED:{MSA:!0,O365:!1,BROWSERS:["Chrome"]},CONTROL:"sharingControl/sharingControl.html",FLIGHTS:{flighttestaacf:"sharingControl/sharingControl.html",flighttestaa:"sharingControl/sharingControl.html",SharingUXCF:"sharingControl/sharingControl.html",SharingUX:"sharingA/sharingA.html"}}}}).factory("experimentService",["$http","$q","$log","experimentConstants","userService",function(e,t,n,r,i){var o,a=null,c={[s.a.USER_TYPE.MSA]:"MSA",[s.a.USER_TYPE.O365]:"O365"},u={getFlight:async function(e){if(!await d(e))return r.EXPERIMENTS[e].CONTROL;return(await l())[e]},getFlights:l,flightingDisabled:function(e){return m(e)},experimentEnabled:d};return u;async function l(){return Utilities.isNotUndefinedOrNull(a)?a:Utilities.isNotUndefinedOrNull(null)?(await Promise.all([null]),a):(await async function(){try{var l=await i.getUserType();if(o=c[l],Utilities.isUndefinedOrNull(l)||l===s.a.USER_TYPE.NONE)throw r.ERROR.BAD_USER_TYPE;if(u.flightingDisabled(l))return void(a=p());var d=await i.waitForUserInfo(l);if(Utilities.isNotUndefinedOrNull(d)&&Utilities.isNotUndefinedOrNull(d.flights))return void(a=d.flights);var m=function(e,t){if(Utilities.isUndefinedOrNull(t))return r.DEFAULT_CLIENT_ID;var n=t.cid||t.id;if(n)return n;return r.DEFAULT_CLIENT_ID}(0,d),T=await function(i){var o=t.defer();if(Utilities.isUndefinedOrNull(i)||i===r.DEFAULT_CLIENT_ID)return n.error("experimentService.getFeatures: clientId is undefined, null, or empty"),o.reject(r.ERROR.NO_CLIENT_ID);var a=(c=function(e){var t,n="";for(t=0;t<e.length;t++)n+=("000"+e.charCodeAt(t).toString(16)).slice(-4);return n}(i),c.length>100?c.substring(0,100):c),s={method:"GET",url:r.ENDPOINT,headers:{"X-MSEDGE-CLIENTID":a}};var c;return e(s).then(e=>{var t=e.data;return t.Features?o.resolve(t.Features):o.reject(r.ERROR.NO_FEATURES)},()=>o.reject(r.ERROR.NO_FEATURES)),o.promise}(m);!function(e){for(var t in a={},r.EXPERIMENTS)r.EXPERIMENTS.hasOwnProperty(t)&&f(e,t);!function(e){for(var t=[],r=0;r<e.length;++r){var i=e[r];E(i)&&t.push(i)}t.length>0&&n.warn("ExP service returned invalid features: "+JSON.stringify(t))}(e)}(T),d.flights=a,d.features=T,await i.saveUserInfo(l,d)}catch(e){n.error("experimentService.setFlights error: "+e),a=p()}}(),a)}async function d(e){try{var t=await i.getUserType();return!u.flightingDisabled(t)&&!m(t,e)}catch(e){return n.error("experimentService.experimentEnabled error: "+e),!1}}function f(e,t){var n=r.EXPERIMENTS[t];if(a[t]=n.CONTROL,n.ENABLED[o])for(var i in n.FLIGHTS)if(n.FLIGHTS.hasOwnProperty(i)&&e.indexOf(i)>-1){a[t]=n.FLIGHTS[i];break}}function p(){var e={};for(var t in r.EXPERIMENTS)if(r.EXPERIMENTS.hasOwnProperty(t)){var n=r.EXPERIMENTS[t];e[t]=n.CONTROL}return e}function E(e){for(var t in r.EXPERIMENTS){if(r.EXPERIMENTS.hasOwnProperty(t))if(r.EXPERIMENTS[t].FLIGHTS.hasOwnProperty(e))return!1}return!0}function m(e,t){if(e===s.a.USER_TYPE.NONE)return!0;var i=r.EXPERIMENTS.hasOwnProperty(t)?r.EXPERIMENTS[t].ENABLED:r.ENABLED,o=t?`experiment ${t} is`:"all experiments are",a=Utilities.getBrowserName().toLowerCase(),u=i.BROWSERS.toString().toLowerCase();if(u.indexOf(a)<0)return n.info(`experimentService: ${o} disabled for browser ${a}. Experiment is only enabled for browsers ${u}`),!0;var l=i[c[e]];return l||n.info(`experimentService: ${o} disabled for userType ${e}`),!l}}]).controller("SharingController",["experimentService",function(e){var t=this,n="/experimentation/sharing/";t.flightView=n+"sharingControl/sharingControl.html",e.getFlight("SHARING").then((function(e){t.flightView=n+e}))}]).factory("sharingService",["$http","$q","$log","userService",function(e,t,n,r){return{setShareUrl:function(e,t){if(a.a.isUndefinedOrNull(e)||a.a.isUndefinedOrNull(e.url))return;if(e.shareUrl="",t===s.a.USER_TYPE.MSA){var n=e.url.replace("&page=view","&page=self");n.indexOf("&page=self")<0&&(n+="&page=self"),n+="&action=share",e.shareUrl=n}},setFlagFromPermissions:function(i,o){if(a.a.isUndefinedOrNull(i))return t.resolve();if(o===s.a.USER_TYPE.MSA){var c=t.defer();return function(n){var i=t.defer();return function(){var e=t.defer();return r.waitForUserInfo(s.a.USER_TYPE.MSA).then((function(t){a.a.isUndefinedOrNull(t)?e.resolve(null):e.resolve(t.cid)})),e.promise}().then((function(t){if(a.a.isUndefinedOrNull(t))i.reject("null cid");else if(a.a.isUndefinedOrNull(n.id))i.reject("no document id");else{var r=n.id.split("."),o=r[r.length-1],c={method:"GET",url:s.a.MSACONFIG.ONEDRIVE_ITEMS_URL+o+"/permissions",headers:{"X-UserType":s.a.USER_TYPE.MSA}};e(c).then((function(e){var n=function(e,t){if(a.a.isUndefinedOrNull(e)||a.a.isUndefinedOrNull(e.value))return!0;for(var n=!0,r=t.substring(1,t.length),i=0;i<e.value.length;++i){var o=e.value[i];if(!a.a.isUndefinedOrNull(o.grantedTo)){var s=o.grantedTo.user;if(s.id===t||s.id===r)n=o.roles.toString().toLowerCase().indexOf("write")>-1}}return n}(e.data,t);i.resolve(n)}),(function(e){i.reject(e.statusText)}))}})),i.promise}(i).then((function(e){i.canBeShared=e,c.resolve()}),(function(e){n.error("sharingService.setFlagFromPermissions error: "+e),i.canBeShared=!1,c.resolve()})),c.promise}return i.canBeShared=!1,t.resolve()}}}]).controller("SharingAController",["$log","sharingService","userService","localize",function(e,t,n,r){var i=this;i.shareDoc=null,i.isChrome=a.a.isChrome(),i.localize=r,i.init=function(e){i.shareDoc=e,n.getUserType().then((function(e){t.setShareUrl(i.shareDoc,e),t.setFlagFromPermissions(i.shareDoc,e)}))},i.shareDocument=function(t){e.trackEvent("ShareRecentDocument",{application:i.shareDoc.application});var n=!(!a.a.isUndefinedOrNull(t)&&!a.a.isUndefinedOrNull(t.ctrlKey))||!t.ctrlKey;a.a.navigateToUrlWithNewTab(i.shareDoc.shareUrl,n),window.close()}}]).name,n(34),n(35),n(23),t.default=i.a.module("app",["localization","ngAria","app.common","app.diagnostics","app.experimentation","app.user","app.mru","app.popup"]).config(["$ariaProvider","$compileProvider","$httpProvider","$provide",function(e,t,n,r,i){e.config({tabindex:!1}),t.imgSrcSanitizationWhitelist(/^\s*(https?|data|chrome-extension|ms-browser-extension):/)}]).name},7:function(e,t,n){"use strict";var r=n(3),i=n.n(r),o=n(2),a=n.n(o),s=(n(9),n(0)),c=n(1),u=n.n(c),l=function(e,t,n,r){var i=0;return{request:function(e){return u.a.isUndefinedOrNull(e.timeout)&&(e.timeout=s.a.TIMEOUT.DEFAULT_REQUEST),e},responseError:function(o){if(o)switch(o.status){case 0:t.debug("httpErrorResponseInterceptor - Request cancelled - "+o.config.url);break;case 401:t.info(`httpErrorResponseInterceptor - ${o.status} - ${o.config.url} - ${JSON.stringify(o.data)}`);break;case 400:if(u.a.isNotUndefinedOrNull(o.data)&&u.a.isNotUndefinedOrNull(o.data.error_codes)&&50001===o.data.error_codes[0]){t.info(`httpErrorResponseInterceptor -  Invalid AADSerivce - ${o.status} - ${JSON.stringify(o.data)}`);break}if(u.a.isNotUndefinedOrNull(o.data)&&u.a.isNotUndefinedOrNull(o.data.error_codes)&&50079===o.data.error_codes[0]){if(t.info(`httpErrorResponseInterceptor -  Interaction required - ${o.status} - ${JSON.stringify(o.data)}`),i<s.a.ERROR_RETRIES.HTTP_REQUEST)return i++,n((function(){return r.get("$http")(o.config)}),s.a.TIMEOUT.USER_INFO_LOOKUP);i=0}break;case 404:if(o.config.url.startsWith("https://graph.microsoft.com/v1.0/me/drive"))return e.resolve(o);default:t.error(`httpErrorResponseInterceptor - ${o.status} - ${o.config.url} - ${JSON.stringify(o.data)}`)}return e.reject(o)}}};var d=n(11);function f(e,t){function n(e){return e.length>8e3?e.substring(0,8e3):e}function r(e,n){try{t.trackTrace(e,n)}catch(e){}}function i(e,t,n,r,i){if(u.a.isBackgroundContext())try{var o=`[${(new Date).toLocaleString(void 0,{month:"numeric",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric"})}] (${function(e){try{const t=new URL(location.href).origin+"/";e=e.toString().replace(t,"")}catch{}return e}(i)}) ${r?r+" ":""} ${e}`;console[t.toLowerCase()](o)}catch{}else a.a.runtime.sendMessage({activity:"log",severity:t,log:e,filename:r,stack:n})}function o(e){return"string"==typeof e?e:JSON.stringify(e)}var s=function(e,t){return function(){var a=[].slice.call(arguments),s=a[0],c=void 0;u.a.isExtensionInDevelopmentMode()&&(c=Error().stack);var l=n(o(s.message?s.message:s));new Promise(e=>{s.stack?e("string"==typeof s.stack?n(s.stack).split("\n"):s.stack):c?Object(d.mapStackTrace)(c,t=>{for(;t[0].match("logDecorator.js");)t.shift();e(t)},{}):e([])}).then(n=>{var o="",c=s.source||location;if(s.filename)o=s.filename;else for(var d of n){var f=d.match(/\b[\w.]+\b:\d+/g);if(f){o=f.pop();break}}i(l,t,n,o,c);var p=(new Date).toLocaleString(void 0,{month:"numeric",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric"});a[0]=`[${p}] ${o?o+" ":""}${t}: ${l}`,u.a.isExtensionInDevelopmentMode()&&e.apply(null,a),"DEBUG"!==t&&r(t,{message:l,stack:"ERROR"===t?n:""})})}};return e.debug=s(e.debug,"DEBUG"),e.info=s(e.info,"INFO"),e.warn=s(e.warn,"WARN"),e.error=s(e.error,"ERROR"),e.getEnabledSetting=function(){return t.getEnabledSetting()},e.setEnabledSetting=function(n){try{t.setEnabledSetting(n)}catch(t){e.error("setEnabledSetting error: "+t)}},e.trackEvent=function(n,r,i){try{t.trackEvent(n,r,i)}catch(t){e.error(`trackEvent error with eventName ${n}: ${t}`)}},e.trackTrace=r,e}window.dumpStorage=()=>{window.chrome&&window.chrome.storage.local.get(null,e=>{console.log(`result '${JSON.stringify(e,"\t")}'`)})};i.a.module("app.common",[]).config(["$httpProvider","$provide",function(e,t){t.decorator("$log",["$delegate","telemetry",f]),e.interceptors.push("httpInterceptor")}]).factory("storage",["$q","$log",function(e,t){return{get:function(n){var r=e.defer();return a.a.storage.local.get(n,(function(e){t.debug(`storage: get '${JSON.stringify(n)}', result '${JSON.stringify(e)}'`),r.resolve(e)})),r.promise},set:function(e){t.debug(`storage: set items '${JSON.stringify(e)}'`),a.a.storage.local.set(e)},remove:function(n){var r=e.defer();return a.a.storage.local.remove(n,(function(e){t.debug(`storage: remove '${JSON.stringify(n)}', result '${JSON.stringify(e)}'`),r.resolve(e)})),r.promise},clear:function(){var n=e.defer();return a.a.storage.local.clear((function(e){t.debug(`storage: clear result '${JSON.stringify(e)}'`),n.resolve(e)})),n.promise}}}]).factory("notification",["$log","localize",function(e,t){return{show:function(n){if(u.a.isBackgroundContext()){var r;if(void 0!==n.buttons&&null!==n.buttons){r=[];for(var i=0;i<n.buttons.length;++i)r[i]={},r[i].title=t.getLocalizedString(n.buttons[i].title),r[i].iconUrl=n.buttons[i].iconUrl}a.a.notifications.clear(n.id,(function(i){a.a.notifications.create(n.id,{iconUrl:"../assets/icon.png",imageUrl:n.imageUrl,message:t.getLocalizedString(n.message),priority:n.priority,progress:n.progress,title:"",type:n.type,buttons:r},(function(t){null==t&&e.error("CreateNotificationError")}))}))}else a.a.runtime.sendMessage({activity:s.a.ACTIVITY.NOTIFICATION.NAME,notification:n})}}}]).factory("httpInterceptor",["$q","$log","$timeout","$injector",l]).name},9:function(e,t){!function(){"use strict";var e=window.BrowserHandler;e||(e=chrome||browser),angular.module("localization",[]).factory("localize",["$filter",function(t){return{getLocalizedString:function(t){return e.i18n.getMessage(t)}}}]).filter("i18n",["localize",function(e){return function(t){return e.getLocalizedString(t)}}]).directive("i18n",["localize",function(e){var t={restrict:"EAC",updateText:function(t,n){var r=n.split("|");if(!(r.length<=1)){var i=e.getLocalizedString(r[0]);if(i){for(var o=1;o<r.length;o++){var a="{"+(o-1)+"}";i=i.replace(a,r[o])}t.text(i)}}},link:function(e,n,r){r.$observe("i18n",(function(e){t.updateText(n,r.i18n)}))}};return t}]).directive("i18nAttr",["localize",function(e){var t={restrict:"EAC",updateText:function(t,n){var r=n.split("|");if(!(r.length<2)){var i=e.getLocalizedString(r[0]);if(i){for(var o=2;o<r.length;o++){var a="{"+(o-2)+"}";i=i.replace(a,r[o])}t.attr(r[1],i)}}},link:function(e,n,r){r.$observe("i18nAttr",(function(e){t.updateText(n,e)}))}};return t}])}()}});